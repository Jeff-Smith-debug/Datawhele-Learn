@[TOC](CV边缘检测)
边缘特点：是函数图像强度快速变化的地方。
如何检测边缘？
为了检测边缘，我们需要检测图像中的不连续性，利用**导数**来检测图像的快速变化。
**导数也会受到噪声的影响，在求导数之前先对图像进行平滑处理**
# 1 学习内容
1、掌握sobel，canny算子检测原理
2、调用OpenCV框架下的API实现
3、进阶自己实现
# 2 算法理论介绍
边缘检测的一般标准包括:
1、以低的错误率检测边缘，也即意味着需要尽可能准确的捕获图像中尽可能多的边缘。
2、检测到的边缘应精确定位在真实边缘的中心。
3、图像中给定的边缘应只被标记一次，并且在可能的情况下，图像的噪声不应产生假的边缘。
## 2.1 sobel算子

### 2.2 sobel算子具体步骤
## 2.3 canny边缘检测
Canny边缘检测是从不同视觉对象中提取有用的结构信息并大大减少要处理的数据量的一种技术，目前已广泛应用于各种计算机视觉系统。Canny使用了变分法。Canny检测器中的最优函数使用四个指数项的和来描述，它可以由高斯函数的一阶导数来近似。
### 2.3.1 canny边缘检测算法步骤
canny算子步骤	                     目的
1.高斯滤波	               去噪声降低错误率
2.计算梯度幅值和方向	      估计每一点处的边缘强度与方向
3.非极大值抑制（NMS）	     对Sobel、Prewitt等算子的结果进一步细化
4应用双阈值（Double-Threshold）检测	  确定真实的和可能的边缘。

## 2.4 canny边缘检测步骤
### 2.4.1 高斯滤波
边缘检测结果容易受到图像噪声的影响，图片中一些噪声会大大影像边缘检测。因此为了使图像平滑，可以用高斯滤波器内核与图像进行卷积。 此步骤将使图像稍微平滑，以减少边缘检测器上明显噪声的影响。
高斯滤波的原理：
**一般选择5*5高斯卷积核例子**
### 2.4.2 计算梯度强度和方向
进行高斯滤波后，图像中的边缘可能指向各个方向，接下来使用四个算子来检测图像中的水平、垂直和对角边缘。边缘检测的算子（如Roberts，Prewitt，Sobel等）返回水平Gx和垂直Gy方向的一阶导数值，由此便可以确定像素点的梯度G和方向θ。
 
其中G为梯度强度， θ表示梯度方向，arctan为反正切函数。通过上式我们可以得到一个梯度矩阵G和方向矩阵 θ。
**这个有必要翻一下高数的书，多再捡一下**
### 2.4.3 非极大值抑制
在每一点上，邻域中心与沿着其对应的梯度方向的两个像素相比，若中心像素为最大值，则保留，否则中心置0，这样可以抑制非极大值，保留局部梯度最大的点，以得到细化的边缘。
对图像进行梯度计算后，仅仅基于梯度值提取的边缘仍然很模糊。对边缘有且应当只有一个准确的响应。而非极大值抑制则可以帮助将局部最大值之外的所有梯度值抑制为0。非极大值抑制是一种边缘稀疏技术，非极大值抑制的作用在于“瘦”边。直观上地看，对第二步得到的图片，边缘由粗变细了。
### 2.4.4 用双阈值算法检测和连接边缘
 
双阈值法非常简单，我们假设两类边缘：经过非极大值抑制之后的边缘点中，梯度值超过TH的称为强边缘，梯度值小于TH大于TL的称为弱边缘，梯度小于TL的不是边缘。
强边缘必然是边缘点，因此必须将T1设置的足够高，以要求像素点的梯度值足够大（变化足够剧烈），而弱边缘可能是边缘，也可能是噪声，如何判断呢？当弱边缘的周围8邻域有强边缘点存在时，就将该弱边缘点变成强边缘点，以此来实现对强边缘的补充。实际中人们发现T1:T2=2:1的比例效果比较好，其中T1可以人为指定，也可以设计算法来自适应的指定，比如定义梯度直方图的前30%的分界线为T1。检查8邻域的方法叫边缘滞后跟踪，连接边缘的办法还有区域生长法等等。

# 3 代码实现
## 3.1 调用OpenCV的API实现
### 3.1.1 实现sobel算子
```python
# %% 导入并读取
import cv2 as cv
import numpy as np
img=cv.imread('lena.jpg')
img=cv.cvtColor(img,cv.COLOR_BGR2GRAY) # 转化为灰度值图像

# %% 使用sobel算子
sobelx=cv.Sobel(img,-1,1,0) 
sobely=cv.Sobel(img,-1,0,1)

sobel=cv.addWeighted(sobelx,0.5,sobely,0.5,0)

cv.imshow('sobelx',sobelx) 
cv.imshow('sobely',sobely)
cv.imshow('sobel',sobel)

cv.waitKey()
cv.destroyAllWindows()

```
### 3.1.2 实现canny算子
```python
# %% 实现canny算子
import numpy as np
import cv2 as cv

img = cv.imread('lena.jpg')
img=cv.cvtColor(img,cv.COLOR_BGR2GRAY) # 转化为灰度值图像

canny = cv.Canny(img,100,200)

cv.imshow('origin',img)
cv.imshow('canny',canny)
cv.waitKey()
cv.destroyAllWindows()
```

## 3.2 自己实现
