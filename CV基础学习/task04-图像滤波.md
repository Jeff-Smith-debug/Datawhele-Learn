@[TOC](Task04-图像滤波)
向前差分，向后差分的概念。
图像的实质是一种二维信号，滤波是数字信号处理中的一个重要概念。在图像处理中，滤波是一种非常常见的技术，就是使用卷积核。滤波是很多图像算法的前置步骤或基础，掌握图像滤波对理解卷积神经网络也有一定帮助。
# 1 学习内容
1、掌握图像滤波的分类和基本概念：均值滤波/方框滤波、高斯滤波；
2、掌握OpenCV框架下的滤波API的使用；
# 2 算法原理
滤波分类：线性滤波、非线性滤波
线性滤波： 对邻域中的像素的计算为线性运算时，如利用窗口函数进行平滑加权求和的运算，或者某种卷积运算，都可以称为线性滤波。常见的线性滤波有：均值滤波、高斯滤波、盒子滤波、拉普拉斯滤波等等，通常线性滤波器之间只是模版系数不同。
非线性滤波： 非线性滤波利用原始图像跟模版之间的一种逻辑关系得到结果，如最值滤波器，中值滤波器。比较常用的有中值滤波器和双边滤波器。
## 2.1 均值滤波、方框滤波
### 2.1.1 方框滤波
方框滤波是一种非常有用的线性滤波，也叫盒子滤波，均值滤波就是盒子滤波归一化的特殊情况。 应用： 可以说，一切需要求某个邻域内像素之和的场合，都有方框滤波的用武之地，比如：均值滤波、引导滤波、计算Haar特征等等。
在原理上，是采用一个卷积核与图像进行卷积：
     
归一化了就是均值滤波；不归一化则可以计算每个像素邻域上的各种积分特性，方差、协方差，平方和等等。
### 2.1.2 均值滤波
应用场合：均值模糊可以模糊图像以便得到感兴趣物体的粗略描述，也就是说，去除图像中的不相关细节，其中“不相关”是指与滤波器模板尺寸相比较小的像素区域，从而对图像有一个整体的认知。即为了对感兴趣的物体得到一个大致的整体的描述而模糊一幅图像，忽略细小的细节。
缺陷： 均值滤波本身存在着固有的缺陷，即它不能很好地保护图像细节，在图像去噪的同时也破坏了图像的细节部分，从而使图像变得模糊，不能很好地去除噪声点。特别是椒盐噪声。
公式表示：
 g(x,y)为该邻域的中心像素，n跟系数模版大小有关，一般3*3邻域的模板。
在实际处理过程中可对图像边界进行扩充，扩充为0或扩充为邻近的像素值。
## 2.2 高斯滤波
应用：高斯滤波是一种线性平滑滤波器，对于服从正态分布的噪声有很好的抑制作用。在实际场景中，我们通常会假定图像包含的噪声为高斯白噪声，所以**在许多实际应用的预处理部分，都会采用高斯滤波抑制噪声**，如传统车牌识别等。
### 2.2.1 原理
高斯滤波和均值滤波一样，都是利用一个掩膜和图像进行卷积求解。均值滤波器的模板系数都是相同的为1，而高斯滤波器的模板系数，则随着距离模板中心的增大而系数减小（服从二维高斯分布）。所以，高斯滤波器相比于均值滤波器对图像个模糊程度较小，更能够保持图像的整体细节。
二维高斯分布 高斯分布公式：
 
其中不必纠结于系数，因为它只是一个常数！并不会影响互相之间的比例关系，并且最终都要进行归一化，所以在实际计算时我们是忽略它而只计算后半部分: 
将各个位置的坐标带入到高斯函数中，得到的值就是模板的系数。
### 2.2.2 高斯模板形式(小数和整数)
1、小数形式的模板，就是直接计算得到的值，没有经过任何的处理；
2、整数形式的，则需要进行归一化处理，将模板左上角的值归一化为1，具体介绍请看这篇博文。使用整数的模板时，需要在模板的前面加一个系数，系数为模板系数和的倒数。
代码实现：
```C++
///////////////////////////////
//x，y方向联合实现获取高斯模板
//////////////////////////////
void generateGaussMask(cv::Mat& Mask,cv::Size wsize, double sigma){
	Mask.create(wsize,CV_64F);
	int h = wsize.height;
	int w = wsize.width;
	int center_h = (h - 1) / 2;
	int center_w = (w - 1) / 2;
	double sum = 0.0;
	double x, y;
	for (int i = 0; i < h; ++i){
		y = pow(i - center_h, 2);
		for (int j = 0; j < w; ++j){
			x = pow(j - center_w, 2);
			//因为最后都要归一化的，常数部分可以不计算，也减少了运算量
			double g = exp(-(x + y) / (2 * sigma*sigma));
			Mask.at<double>(i, j) = g;
			sum += g;
		}
	}
	Mask = Mask / sum;
}
```
## 2.3 中位滤波
将中心元素替换为该中值。这对于消除图像中的椒盐噪声非常有效；
## 2.4 双边滤波

# 3 代码实践
## 3.1 OpenCV框架下API
使用python编程，使用用OpenCV框架
### 3.1.1 均值滤波
```python
# %% 均值滤波 调用OpenCV
# 调用 cv.blur()或cv.boxFilter()完成的
import cv2 as cv
import numpy as np
from matplotlib import pyplot as plt
img =cv.imread('lena.jpg')
blur= cv.blur(img,(5,5))
plt.subplot(121),plt.imshow(img),plt.title('Original')
plt.xticks([]), plt.yticks([])
plt.subplot(122),plt.imshow(blur),plt.title('Blurred')
plt.xticks([]), plt.yticks([])
plt.show()
```
### 3.1.2 高斯滤波
```python
# %% 高斯滤波 使用高斯核
# 调用cv.GaussianBlur() 来完成
import cv2 as cv
import numpy as np
from matplotlib import pyplot as plt
img =cv.imread('lena.jpg')
blur=cv.GaussianBlur(img,(5,5),0)
plt.subplot(121),plt.imshow(img),plt.title('Original')
plt.xticks([]), plt.yticks([])
plt.subplot(122),plt.imshow(blur),plt.title('Blurred')
plt.xticks([]), plt.yticks([])
plt.show()
```
## 3.2 提高
pass


